<!doctype html>
<html lang="{{.Lang}}">
<head>
  <meta charset="utf-8">
  <title>{{if eq .Lang "es"}}Eventos en Plaza de España{{else}}Plaza de España events{{end}}</title>
  <meta name="description" content="{{if eq .Lang "es"}}Calendario actualizado de eventos culturales, festivales y actividades cerca de Plaza de España en Madrid. Información de eventos del Ayuntamiento de Madrid.{{else}}Updated calendar of cultural events, festivals and activities near Plaza de España in Madrid. Event information from Madrid City Council.{{end}}">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="{{.BasePath}}/assets/site.{{.CSSHash}}.css">
</head>
<body>
  <input type="checkbox" id="toggle-cultural" {{if .ShowCulturalDefault}}checked{{end}}>

  <!-- Distance filter radio buttons -->
  <input type="radio" name="distance-filter" id="distance-nearby" value="nearby">
  <input type="radio" name="distance-filter" id="distance-plaza" value="plaza" checked>

  <header>
    <h1>{{if eq .Lang "es"}}Eventos en Plaza de España (Madrid){{else}}Events at Plaza de España (Madrid){{end}}</h1>
    <p class="stamp">Última actualización: {{.LastUpdated}}</p>
    {{if gt .TotalEvents 0}}
    <p class="stamp">Total: {{.TotalCityEvents}} eventos de ciudad{{if gt .TotalCulturalEvents 0}}, {{.TotalCulturalEvents}} eventos culturales{{end}}</p>
    {{end}}

    <!-- Filters container -->
    <div class="filters-container">
      <!-- Distance filter -->
      <div class="distance-filter">
        <label class="filter-title">Mostrar:</label>
        <div class="distance-options">
          <label for="distance-plaza" class="distance-label">
            En Plaza
            <span class="filter-count-city">({{.TotalCityPlaza}})</span>
            <span class="filter-count-all">({{.TotalPlaza}})</span>
          </label>
          <label for="distance-nearby" class="distance-label">
            Cerca (todos)
            <span class="filter-count-city">({{.TotalCityNearby}})</span>
            <span class="filter-count-all">({{.TotalNearby}})</span>
          </label>
        </div>
      </div>

      {{if gt .TotalCulturalEvents 0}}
      <div class="cultural-filter">
        <label for="toggle-cultural" class="toggle-label">
          Mostrar eventos culturales ({{.TotalCulturalEvents}})
        </label>
      </div>
      {{end}}
    </div>
  </header>

  <main>
    {{/* Ongoing events (merged) - shown first by default, reordered dynamically if empty */}}
    <section class="event-section time-group"
      data-count-plaza="{{.OngoingPlaza}}"
      data-count-nearby="{{.OngoingNearby}}"
      data-count-plaza-city="{{.OngoingCityPlaza}}"
      data-count-nearby-city="{{.OngoingCityNearby}}">
      <h2 class="section-header">
        <span class="section-icon" aria-hidden="true">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="#ea580c">
            <path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8z"/>
            <path d="M1 0 0 1l2.2 3.081a1 1 0 0 0 .815.419h.07a1 1 0 0 1 .708.293l2.675 2.675-2.617 2.654A3.003 3.003 0 0 0 0 13a3 3 0 1 0 5.878-.851l2.654-2.617.968.968-.305.914a1 1 0 0 0 .242 1.023l3.356 3.356a1 1 0 0 0 1.414 0l1.586-1.586a1 1 0 0 0 0-1.414l-3.356-3.356a1 1 0 0 0-1.023-.242L10.5 9.5l-.96-.96 2.68-2.643A3.005 3.005 0 0 0 16 3c0-.269-.035-.53-.102-.777l-2.14 2.141L12 4l-.364-1.757L13.777.102a3 3 0 0 0-3.675 3.68L7.462 6.46 4.793 3.793a1 1 0 0 1-.293-.707v-.071a1 1 0 0 0-.419-.814L1 0zm9.646 10.646a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708zM3 11l.471.242.529.026.287.445.445.287.026.529L5 13l-.242.471-.026.529-.445.287-.287.445-.529.026L3 15l-.471-.242L2 14.732l-.287-.445L1.268 14l-.026-.529L1 13l.242-.471.026-.529.445-.287.287-.445.529-.026L3 11z"/>
          </svg>
        </span>
        Eventos en Curso
        <span class="event-count">
          <span class="count-nearby-city">{{.OngoingCityNearby}}</span>
          <span class="count-nearby-all">{{.OngoingNearby}}</span>
          <span class="count-plaza-city">{{.OngoingCityPlaza}}</span>
          <span class="count-plaza-all">{{.OngoingPlaza}}</span>
        </span>
      </h2>

      {{range .OngoingEvents}}
      <article class="event-card {{.EventType}}" id="ev-{{.IDEvento}}" data-distance-m="{{.DistanceMeters}}"{{if .AtPlaza}} data-at-plaza="true"{{end}}>
        {{if eq .EventType "city"}}
        <span class="event-badge city-badge">Evento Ciudad</span>
        {{else}}
        <span class="event-badge cultural-badge">Cultural</span>
        {{end}}
        <h3>{{.Titulo}}</h3>
        <p class="when">{{.StartHuman}}</p>
        {{if .NombreInstalacion}}<p class="where">{{.NombreInstalacion}}</p>{{end}}
        {{if .DistanceHuman}}<p class="distance"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="#666" aria-hidden="true"><path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/></svg>{{.DistanceHuman}} de Plaza de España</p>{{end}}
        {{if .Description}}<p class="description">{{.Description}}</p>{{end}}
        {{if .ContentURL}}<p><a href="{{.ContentURL}}">{{if eq $.Lang "es"}}Más información sobre {{.Titulo}}{{else}}More information about {{.Titulo}}{{end}}</a></p>{{end}}
      </article>
      {{end}}
    </section>

    {{/* Merged time groups with both city and cultural events */}}
    {{range .Groups}}
    <section class="event-section time-group"
      data-count-plaza="{{.CountPlaza}}"
      data-count-nearby="{{.CountNearby}}"
      data-count-plaza-city="{{.CityPlaza}}"
      data-count-nearby-city="{{.CityNearby}}">
      <h2 class="section-header">
        <span class="section-icon" aria-hidden="true">{{.Icon}}</span>
        {{.Name}}
        <span class="event-count">
          <span class="count-nearby-city">{{.CityNearby}}</span>
          <span class="count-nearby-all">{{.CountNearby}}</span>
          <span class="count-plaza-city">{{.CityPlaza}}</span>
          <span class="count-plaza-all">{{.CountPlaza}}</span>
        </span>
      </h2>

      {{range .Events}}
      <article class="event-card {{.EventType}}" id="ev-{{.IDEvento}}" data-distance-m="{{.DistanceMeters}}"{{if .AtPlaza}} data-at-plaza="true"{{end}}>
        {{if eq .EventType "city"}}
        <span class="event-badge city-badge">Evento Ciudad</span>
        {{else}}
        <span class="event-badge cultural-badge">Cultural</span>
        {{end}}
        <h3>{{.Titulo}}</h3>
        <p class="when">{{.StartHuman}}</p>
        {{if .NombreInstalacion}}<p class="where">{{.NombreInstalacion}}</p>{{end}}
        {{if .DistanceHuman}}<p class="distance"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="#666" aria-hidden="true"><path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/></svg>{{.DistanceHuman}} de Plaza de España</p>{{end}}
        {{if .Description}}<p class="description">{{.Description}}</p>{{end}}
        {{if .ContentURL}}<p><a href="{{.ContentURL}}">{{if eq $.Lang "es"}}Más información sobre {{.Titulo}}{{else}}More information about {{.Titulo}}{{end}}</a></p>{{end}}
      </article>
      {{end}}
    </section>
    {{end}}

    {{if and (eq (len .Groups) 0) (eq (len .OngoingEvents) 0)}}
    <p class="no-events">No hay eventos próximos.</p>
    {{end}}
  </main>

  <footer>
    <p>Datos: <a href="https://datos.madrid.es">Ayuntamiento de Madrid – datos.madrid.es</a> y <a href="https://www.esmadrid.com">ESMadrid</a></p>
    <p><a href="{{.BasePath}}/build-report.html">Ver informe de compilación</a></p>
  </footer>
</body>
</html>
