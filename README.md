#  “Plaza de España events (Madrid)” — static site generated by a Go + cron job on NearlyFreeSpeech.NET

_Last touched: 2025-10-19 (Europe/Madrid)._

## 0) Goal / user need (as stated)
- Host a tiny, **highly cacheable static website** on NearlyFreeSpeech.NET (NFSN) that **pulls Madrid’s open events dataset** on a **daily or hourly** cadence, **filters to events at/near Plaza de España (Madrid)**, and **regenerates** the site.
- **No long-running DB**. SQLite optional; regeneration from the feed is fine.
- **Git-driven & portable**. One repo contains everything: code, build instructions, and server setup notes.
- **Robust & cheap**. If untouched for a year, it should still work—even if the feed goes down for a week.

## 1) Source data & canonical links
Primary dataset: _Agenda de actividades y eventos_ (Ayuntamiento de Madrid)
- Dataset landing (Ayto portal):  
  https://datos.madrid.es/portal/site/egob/menuitem.c05c1f754a33a9fbe4b2e4b284f1a5a0/?vgnextchannel=374512b9ace9f310VgnVCM100000171f5a0aRCRD&vgnextfmt=default&vgnextoid=57be24206a91b510VgnVCM2000001f4a900aRCRD
- Direct distribution endpoints (from datos.gob.es mirror pointing to Ayto):
  - CSV:  https://datos.madrid.es/egob/catalogo/300107-0-agenda-actividades-eventos.csv
  - GeoRSS:  https://datos.madrid.es/egob/catalogo/300107-0-agenda-actividades-eventos.geo
  - JSON:  https://datos.madrid.es/egob/catalogo/300107-0-agenda-actividades-eventos.json
  - RDF:  https://datos.madrid.es/egob/catalogo/300107-0-agenda-actividades-eventos.rdf
  - XML:  https://datos.madrid.es/egob/catalogo/300107-0-agenda-actividades-eventos.xml
- Dataset on EU portal (reference mirror):  
  https://data.europa.eu/data/datasets/https-datos-madrid-es-egob-catalogo-300107-0-agenda-actividades-eventos?locale=en
- API overview (Ayto):  
  https://datos.madrid.es/portal/site/egob/menuitem.214413fe61bdd68a53318ba0a8a409a0/?vgnextchannel=b07e0f7c5ff9e510VgnVCM1000008a4a900aRCRD

Dataset structure (fields, caching notes, formats):  
- PDF: “Estructura para Eventos provenientes de www.madrid.es”  
  https://datos.madrid.es/FWProjects/egob/Catalogo/XComun/Ficheros/Estructura_DS_eventos_wwwmadrid.pdf  
  (Fields include: `ID-EVENTO`, `TITULO`, `FECHA`, `FECHA-FIN`, `HORA`, `CONTENT-URL`, `NOMBRE-INSTALACION`, `COORDENADA-LATITUD`, `COORDENADA-LONGITUD`, etc.; notes a multi-hour upstream cache.)

License / reuse (attribution):  
- https://datos.madrid.es/portal/site/egob/menuitem.400a817358ce98c34e937436a8a409a0/?vgnextchannel=dab92f5fd9c91410VgnVCM100000171f5a0aRCRD  
- https://datos.madrid.es/portal/site/egob/menuitem.400a817358ce98c34e937436a8a409a0/?vgnextchannel=b4c412b9ace9f310VgnVCM100000171f5a0aRCRD

## 2) Location filter (Plaza de España, Madrid)
- Reference point (WGS-84): ~**40.42338, −3.71217**  
  https://www.latlong.net/place/plaza-de-espa-a-madrid-spain-23249.html  
  (Cross-check background: https://en.wikipedia.org/wiki/Plaza_de_Espa%C3%B1a%2C_Madrid)
- Practical filter: **radius 300–400 m** around that point, plus a **secondary text match** (case-insensitive) on fields like `NOMBRE-INSTALACION`, `DIRECCION`, etc., containing “Plaza de España” (mind homonyms in other cities; keep geo constraint primary).

## 3) Data ingestion & fallbacks (robustness first)
Fetch strategy each run (hourly/daily):
1) **Try JSON** (fastest to parse in Go).  
2) If JSON fails, **fall back to XML** (tags match structure doc).  
3) If XML fails, **fall back to CSV** (usually semicolon-separated; handle decimal locales).  
4) If all fail, **serve last good snapshot** and mark output as “stale”.

Operational notes:
- Maintain **`/home/data/last_success.{json|xml|csv}`** and a normalized **`/home/data/events-normalized.json`** that the site renderer uses.  
- **Rate-limit & backoff** on HTTP errors; set a helpful `User-Agent` with contact.  
- **Deduplicate** by `ID-EVENTO`.  
- Normalize datetimes to **Europe/Madrid**; when `HORA` missing → treat as all-day (date-only UI).

## 4) Filtering & presentation
- **Spatial filter**: haversine( event_lat, event_lon, 40.42338, −3.71217 ) ≤ **0.35 km** (tunable).  
  Fallback: name contains “Plaza de España” and within a bounding box around central Madrid.
- Sort upcoming by **start datetime**; drop events in the past.
- Output two public artifacts:
  - `public/index.html` — minimal static page (vanilla HTML) listing upcoming events.  
  - `public/events.json` — machine-readable payload mirroring the list.
- Optional niceties (still static):
  - `public/plaza.ics` (calendar feed you generate).
  - A small Leaflet map (pre-tiled, no live API keys).

## 5) Hosting on NearlyFreeSpeech.NET
- **Document root** defaults to **`/home/public`**.  
  https://faq.nearlyfreespeech.net/section/customization/-  (see “per-alias document root” → default `/home/public`)
- **Scheduled tasks** (cron-like) for all server types, as often as **every 10 minutes**.  
  https://faq.nearlyfreespeech.net/q/cron
- **Cron output** goes to email; if too large/bounced, it lands in `/home/logs`.  
  https://faq.nearlyfreespeech.net/section/programming/-  (search “Output from the scheduled task (stdout and stderr)…”)
- **.htaccess works** (Apache), so you can set `Expires` / `Cache-Control`.  
  https://faq.nearlyfreespeech.net/q/htaccess  
  Apache mod_expires ref: https://httpd.apache.org/docs/current/mod/mod_expires.html
- **SQLite** is supported; caution on write concurrency/scaling (fine here; we can also avoid it).  
  https://faq.nearlyfreespeech.net/q/sql  
  https://faq.nearlyfreespeech.net/q/scalability
- Environment: **FreeBSD** on 64-bit hardware (member sites run on FreeBSD).  
  https://faq.nearlyfreespeech.net/full/hardware
- Tip: NFSN’s edge will honor your cache headers; set them to let their network cache static content.  
  https://faq.nearlyfreespeech.net/full/  (see “Take advantage of our network to cache whatever you can.”)

## 6) Build/deploy toolchain: Go + cross-compile for NFSN
- Cross-compile locally to a single static binary; upload binary + templates:
  ```bash
  # Example: build a FreeBSD/amd64 binary
  GOOS=freebsd GOARCH=amd64 CGO_ENABLED=0 go build -trimpath -ldflags="-s -w" -o build/buildsite ./cmd/buildsite
  ```
  Go cross-compile background:  
  https://go.dev/doc/install/source  
  https://opensource.com/article/21/1/go-cross-compiling
- **Avoid cgo** if possible (pure Go JSON/XML/CSV). If you later add SQLite via `github.com/mattn/go-sqlite3`, cross-compiling with `CGO_ENABLED=1` to FreeBSD requires a FreeBSD-targeting C toolchain. Example pitfall:  
  https://groups.google.com/g/golang-nuts/c/HRvOcZ5YB0I

## 7) Repo layout (single repo, reproducible)
```
/cmd/buildsite/        # main.go: fetch → parse → normalize → filter → render
/internal/
  fetch/               # HTTP client, retries, decode JSON/XML/CSV
  parse/               # struct defs + per-format decoders
  filter/              # geo filter, text fallback, dedupe
  render/              # html/template for index.html; write events.json; optional .ics
/templates/
  index.tmpl.html
/scripts/
  run_once.sh          # invokes /home/bin/buildsite; atomic writes
  install_cron.md      # Scheduled Tasks UI command + schedule
/web/                  # css/logo (hashed filenames for long cache)
/ops/
  htaccess             # .htaccess with caching rules → copied to /home/public/.htaccess
  nfsn-notes.md        # site setup checklist (aliases, TLS redirect, logs)
/README.md
```

## 8) Cron job (NFSN “Scheduled Task”)
- **Command** (adjust paths as needed):
  ```
  /home/bin/buildsite \
    -json-url https://datos.madrid.es/egob/catalogo/300107-0-agenda-actividades-eventos.json \
    -xml-url  https://datos.madrid.es/egob/catalogo/300107-0-agenda-actividades-eventos.xml \
    -csv-url  https://datos.madrid.es/egob/catalogo/300107-0-agenda-actividades-eventos.csv \
    -out-dir /home/public \
    -data-dir /home/data \
    -lat 40.42338 -lon -3.71217 -radius-km 0.35 \
    -timezone Europe/Madrid
  ```
- **Schedule**: hourly is sufficient; 10-minute cadence is possible.
- **Behavior**:
  - On success → write temp files then **atomic rename** to `index.html` / `events.json`.
  - On fetch failure → **reuse last_success**; emit a clear error to stderr (so you’ll see it via email) but keep serving the previous snapshot.

## 9) Caching & headers (`/home/public/.htaccess`)
Keep HTML/JSON TTL short (so browsers revalidate frequently); keep CSS/JS/images long (hashed filenames).
```apache
<IfModule mod_expires.c>
  ExpiresActive On
  # Dynamic-ish documents (small TTL)
  ExpiresByType text/html "access plus 5 minutes"
  ExpiresByType application/json "access plus 5 minutes"
  # Static assets (long TTL)
  ExpiresByType text/css "access plus 30 days"
  ExpiresByType application/javascript "access plus 30 days"
  ExpiresByType image/* "access plus 30 days"
</IfModule>
<IfModule mod_headers.c>
  Header unset ETag
</IfModule>
FileETag None
```
(Apache reference: https://httpd.apache.org/docs/current/mod/mod_expires.html)

## 10) Light Go sketch (illustrative only)
```go
// Types reflect structure PDF field names. Real code should map & sanitize thoroughly.
type Event struct {
  IDEvento          string  `json:"ID-EVENTO" xml:"ID-EVENTO"`
  Titulo            string  `json:"TITULO" xml:"TITULO"`
  Fecha             string  `json:"FECHA" xml:"FECHA"`
  FechaFin          string  `json:"FECHA-FIN" xml:"FECHA-FIN"`
  Hora              string  `json:"HORA" xml:"HORA"`
  NombreInstalacion string  `json:"NOMBRE-INSTALACION" xml:"NOMBRE-INSTALACION"`
  Lat               float64 `json:"COORDENADA-LATITUD" xml:"COORDENADA-LATITUD"`
  Lon               float64 `json:"COORDENADA-LONGITUD" xml:"COORDENADA-LONGITUD"`
  ContentURL        string  `json:"CONTENT-URL" xml:"CONTENT-URL"`
}

// Pseudocode:
// 1) Try JSON → XML → CSV, normalize to []Event, dedupe by IDEvento
// 2) Parse times to time.Time in Europe/Madrid; drop past events
// 3) Keep those within radius of (40.42338, -3.71217)
// 4) Render index.html (html/template) + events.json
// 5) Atomic rename temp → public files; update last_success.*
```

## 11) Operations & resilience checklist
- **Idempotent generator**; atomic writes (no partial outputs).
- Maintain **last_success** snapshots for display when upstream is down.
- Embed “**Last updated: 2025-10-19 HH:MM Europe/Madrid**” on page.
- Respect **license/attribution** (Ayuntamiento de Madrid – datos.madrid.es + dataset link).
- **Backoff + timeout** the fetcher to avoid cascading issues.
- **No secrets** on server (no API keys); repo-driven deploy (rsync/SFTP).
- **TLS redirect** via NFSN config; optional `.htaccess` if desired.

## 12) Why Go + cron on NFSN
- **Robust**: a single static binary run by NFSN’s scheduler; no daemon babysitting.
- **Cheap**: static hosting + scheduled task; no managed DB needed.
- **Portable & git-driven**: repo contains code, templates, `.htaccess`, ops notes; server setup = one scheduled task.
- **Resilience**: stale snapshot continues serving if source feed is unavailable.

---

## Appendix A — Direct dataset endpoints (copy/paste)
- JSON: https://datos.madrid.es/egob/catalogo/300107-0-agenda-actividades-eventos.json  
- XML:  https://datos.madrid.es/egob/catalogo/300107-0-agenda-actividades-eventos.xml  
- CSV:  https://datos.madrid.es/egob/catalogo/300107-0-agenda-actividades-eventos.csv  
- GeoRSS: https://datos.madrid.es/egob/catalogo/300107-0-agenda-actividades-eventos.geo  
- RDF: https://datos.madrid.es/egob/catalogo/300107-0-agenda-actividades-eventos.rdf

## Appendix B — Plaza de España reference coords
- https://www.latlong.net/place/plaza-de-espa-a-madrid-spain-23249.html  
- https://en.wikipedia.org/wiki/Plaza_de_Espa%C3%B1a%2C_Madrid

## Appendix C — NFSN docs (cron, paths, caching, OS)
- Cron / Scheduled Tasks: https://faq.nearlyfreespeech.net/q/cron  
- Document root (`/home/public` default; per-alias roots): https://faq.nearlyfreespeech.net/section/customization/-  
- .htaccess allowed: https://faq.nearlyfreespeech.net/q/htaccess  
- “Cache what you can” note: https://faq.nearlyfreespeech.net/full/  (search “Take advantage of our network to cache…”)  
- Cron output email / `/home/logs`: https://faq.nearlyfreespeech.net/section/programming/-  
- SQLite & DB notes: https://faq.nearlyfreespeech.net/q/sql  
- SQLite scalability caution: https://faq.nearlyfreespeech.net/q/scalability  
- Hardware/OS (FreeBSD for member sites): https://faq.nearlyfreespeech.net/full/hardware

## Appendix D — License / reuse
- Aviso legal: https://datos.madrid.es/portal/site/egob/menuitem.400a817358ce98c34e937436a8a409a0/?vgnextchannel=dab92f5fd9c91410VgnVCM100000171f5a0aRCRD  
- Condiciones de uso: https://datos.madrid.es/portal/site/egob/menuitem.400a817358ce98c34e937436a8a409a0/?vgnextchannel=b4c412b9ace9f310VgnVCM100000171f5a0aRCRD

## Appendix E — Go cross-compile references
- Official docs (install from source / cross-compile toolchains): https://go.dev/doc/install/source  
- How-to (overview): https://opensource.com/article/21/1/go-cross-compiling  
- cgo cross-compilation pitfall (SQLite example): https://groups.google.com/g/golang-nuts/c/HRvOcZ5YB0I

## Appendix F — Apache caching header reference
- mod_expires (official): https://httpd.apache.org/docs/current/mod/mod_expires.html

# Frontend: Option A (hand-rolled CSS, no build step) and Option B (vendored classless CSS)
_Design goals: fully static, ultra-cacheable, robust if untouched for a year, git-driven, no external CDNs, minimal JS (or none)._

---

## Option A — Hand-rolled CSS (recommended for durability)

### Files (suggested)
```
/templates/
  index.tmpl.html
/assets/
  site.<hash>.css          # produced by your build step that computes a hash over the CSS content
/public/                   # generated output (index.html + events.json + optional plaza.ics)
/ops/
  htaccess                 # copied to /home/public/.htaccess
```

### `templates/index.tmpl.html` (Go `html/template`)
```html
<!doctype html>
<html lang="{{ .Lang }}">
<head>
  <meta charset="utf-8">
  <title>{{ if eq .Lang "es" }}Eventos en Plaza de España{{ else }}Plaza de España events{{ end }}</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="{{ .MetaDescription }}">
  <link rel="preload" href="/assets/site.{{ .CSSHash }}.css" as="style">
  <link rel="stylesheet" href="/assets/site.{{ .CSSHash }}.css">
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'none'; style-src 'self'; img-src 'self' data:; font-src 'self'; base-uri 'none'; frame-ancestors 'none'">
  <meta name="referrer" content="no-referrer">
</head>
<body>
  <a class="skip" href="#main">{{ if eq .Lang "es" }}Saltar al contenido{{ else }}Skip to content{{ end }}</a>

  <header class="site-header">
    <h1>{{ if eq .Lang "es" }}Eventos en Plaza de España (Madrid){{ else }}Events at Plaza de España (Madrid){{ end }}</h1>
    <nav class="nav">
      <a href="#today">{{ .Strings.Today }}</a>
      <a href="#this-week">{{ .Strings.ThisWeek }}</a>
      <a href="#next-week">{{ .Strings.NextWeek }}</a>
      <a href="#upcoming">{{ .Strings.AllUpcoming }}</a>
    </nav>
    <p class="stamp">{{ .Strings.LastUpdated }} {{ .LastUpdatedLocal }}</p>
  </header>

  <main id="main" class="events">
    {{range .Sections}}
      <section id="{{.ID}}">
        <h2>{{.Title}}</h2>
        {{if .Events}} {{range .Events}}
          <article id="ev-{{.IDEvento}}" class="card">
            <h3><a href="#ev-{{.IDEvento}}">{{.Titulo}}</a></h3>
            <p class="when">
              <time datetime="{{.StartISO}}">{{.StartHuman}}</time>
              {{if .EndISO}}–<time datetime="{{.EndISO}}">{{.EndHuman}}</time>{{end}}
            </p>
            {{if .NombreInstalacion}}<p class="where">{{.NombreInstalacion}}</p>{{end}}
            {{if .ContentURL}}<p><a class="btn" href="{{.ContentURL}}">{{ .Strings.Details }}</a></p>{{end}}
            <p class="meta"><a href="plaza.ics#{{.IDEvento}}">{{ .Strings.AddToCal }}</a></p>

            <!-- Structured data for SEO/consumers -->
            <script type="application/ld+json">
            {{.JSONLD}}
            </script>
          </article>
        {{end}}{{else}}
          <p class="muted">{{ .Strings.NoEvents }}</p>
        {{end}}
      </section>
    {{end}}
  </main>

  <footer class="site-footer">
    <p>{{ .Strings.Attribution }} <a href="{{ .DatasetURL }}">datos.madrid.es</a></p>
  </footer>
</body>
</html>
```

### `/assets/site.css` (hand-rolled; keep ≤ ~8–12 KB, then hash to `site.<hash>.css`)
```css
:root{
  --bg:#ffffff; --fg:#111; --muted:#666; --card:#f6f6f6; --link:#0645ad; --accent:#2151d1;
  --radius:14px; --shadow:0 1px 4px rgba(0,0,0,.06); --max:900px;
}
@media (prefers-color-scheme:dark){
  :root{ --bg:#0f1115; --fg:#eaeaea; --muted:#9aa0a6; --card:#1a1d24; --link:#8ab4f8; --accent:#8ab4f8; }
}
*{box-sizing:border-box} html{scroll-behavior:smooth}
body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
.site-header,.site-footer{max-width:var(--max);margin:auto;padding:1rem}
.nav a{margin-right:.75rem}
.stamp{color:var(--muted);font-size:.9rem;margin:.25rem 0}
.events{max-width:var(--max);margin:auto;padding:1rem;display:grid;gap:1rem}
section>h2{margin:1.25rem 0 .5rem}
.card{background:var(--card);border-radius:var(--radius);padding:1rem;box-shadow:var(--shadow)}
.card h3{margin:.2rem 0 .4rem}
.when,.where,.meta{margin:.25rem 0}
a{color:var(--link)} a:focus{outline:2px solid var(--accent);outline-offset:2px}
.btn{display:inline-block;padding:.4rem .65rem;border-radius:10px;background:var(--accent);color:#fff;text-decoration:none}
.muted{color:var(--muted)}
.skip{position:absolute;left:-9999px}
.skip:focus{left:1rem;top:1rem;background:#ffd;padding:.5rem;z-index:999}
```

### `.htaccess` (copy to `/home/public/.htaccess`)
```apache
# Caching (short TTL for HTML/JSON, long for assets)
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType text/html "access plus 5 minutes"
  ExpiresByType application/json "access plus 5 minutes"
  ExpiresByType text/css "access plus 30 days"
  ExpiresByType application/javascript "access plus 30 days"
  ExpiresByType image/* "access plus 30 days"
</IfModule>
<IfModule mod_headers.c>
  Header always set Content-Security-Policy "default-src 'none'; style-src 'self'; img-src 'self' data:; font-src 'self'; base-uri 'none'; frame-ancestors 'none'"
  Header always set Referrer-Policy "no-referrer"
  Header always set X-Content-Type-Options "nosniff"
  Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"
  Header always set X-Frame-Options "DENY"
  Header unset ETag
</IfModule>
FileETag None
```

### Notes (Option A)
- **No JS** by default. If you later add a tiny filter, vendor one small `enhance.<hash>.js` (no inline JS) and change CSP to `script-src 'self'`.
- **Asset hashing:** compute `.CSSHash` (and optional `.JSHash`) during the Go build step; rename files accordingly; reference via template data.
- **i18n:** render `/en/index.html` and `/es/index.html` by calling the template twice with different `.Lang` and `.Strings`.

---

## Option B — Vendored classless CSS (no CDN, still tiny)

### What changes
- Use a small **classless** CSS file (e.g., Pico.css, Water.css) **vendored into your repo** under `/assets/vendor/…`, and keep your own overrides minimal.
- You write almost no CSS; the HTML can be simpler (semantic tags get decent defaults).
- **No external fetches**; the file is hashed (e.g., `pico.<hash>.min.css`) and referenced locally.

### Files (suggested)
```
/templates/
  index.tmpl.html
/assets/vendor/
  pico.<hash>.min.css       # or water.<hash>.min.css — committed to repo, not fetched from CDN
/assets/
  overrides.<hash>.css      # tiny file that tweaks spacing/colors if desired
/public/
  ...
```

### `templates/index.tmpl.html` (classless variant)
```html
<!doctype html>
<html lang="{{ .Lang }}">
<head>
  <meta charset="utf-8">
  <title>{{ if eq .Lang "es" }}Eventos en Plaza de España{{ else }}Plaza de España events{{ end }}</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="{{ .MetaDescription }}">
  <!-- Vendored classless CSS + small overrides -->
  <link rel="preload" href="/assets/vendor/pico.{{ .VendorCSSHash }}.min.css" as="style">
  <link rel="stylesheet" href="/assets/vendor/pico.{{ .VendorCSSHash }}.min.css">
  <link rel="stylesheet" href="/assets/overrides.{{ .OverridesHash }}.css">
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'none'; style-src 'self'; img-src 'self' data:; font-src 'self'; base-uri 'none'; frame-ancestors 'none'">
</head>
<body>
  <header>
    <h1>{{ if eq .Lang "es" }}Eventos en Plaza de España (Madrid){{ else }}Events at Plaza de España (Madrid){{ end }}</h1>
    <nav>
      <ul>
        <li><a href="#today">{{ .Strings.Today }}</a></li>
        <li><a href="#this-week">{{ .Strings.ThisWeek }}</a></li>
        <li><a href="#next-week">{{ .Strings.NextWeek }}</a></li>
        <li><a href="#upcoming">{{ .Strings.AllUpcoming }}</a></li>
      </ul>
    </nav>
    <p><small>{{ .Strings.LastUpdated }} {{ .LastUpdatedLocal }}</small></p>
  </header>

  <main id="main">
    {{range .Sections}}
      <section id="{{.ID}}">
        <h2>{{.Title}}</h2>
        {{if .Events}} {{range .Events}}
          <article id="ev-{{.IDEvento}}">
            <header>
              <h3><a href="#ev-{{.IDEvento}}">{{.Titulo}}</a></h3>
              <p>
                <time datetime="{{.StartISO}}">{{.StartHuman}}</time>
                {{if .EndISO}}–<time datetime="{{.EndISO}}">{{.EndHuman}}</time>{{end}}
              </p>
            </header>
            {{if .NombreInstalacion}}<p><em>{{.NombreInstalacion}}</em></p>{{end}}
            {{if .ContentURL}}<p><a href="{{.ContentURL}}">{{ .Strings.Details }}</a></p>{{end}}
            <p><a href="plaza.ics#{{.IDEvento}}">{{ .Strings.AddToCal }}</a></p>
            <script type="application/ld+json">{{.JSONLD}}</script>
          </article>
        {{end}}{{else}}
          <p><em>{{ .Strings.NoEvents }}</em></p>
        {{end}}
      </section>
    {{end}}
  </main>

  <footer>
    <p>{{ .Strings.Attribution }} <a href="{{ .DatasetURL }}">datos.madrid.es</a></p>
  </footer>
</body>
</html>
```

### `/assets/overrides.css` (keep very small)
```css
/* Minimal tweaks layered atop the classless CSS */
:root{ --max:900px }
header, main, footer{ max-width:var(--max); margin:auto; }
article{ border-radius:12px; padding:1rem }
```

### `.htaccess` (same as Option A)
- Reuse the same caching + security headers; only difference is you’ll now hash **two** CSS files (`VendorCSSHash` and `OverridesHash`) and reference them in the template.

### Notes (Option B)
- **No CDN**: commit the minified classless CSS to the repo; periodically bump it manually if you ever care.
- **Fail-safe**: if overrides fail to load, the classless CSS still yields readable defaults.
- **No JS** by default; CSP stays strict.

---

## Shared best practices for both options
- **Asset hashing:** compute content hashes at build time; output filenames like `site.<hash>.css` (A) or `pico.<hash>.min.css` + `overrides.<hash>.css` (B). Pass those hashes into templates as `.CSSHash`, `.VendorCSSHash`, `.OverridesHash`.
- **Short TTL for HTML/JSON (5 min)**; long TTL for hashed assets (30 days+).
- **Accessibility:** proper headings, focus styles, `lang` attribute, skip link, `<time datetime>` markup.
- **Structured data:** output per-event JSON-LD (`schema.org/Event`) in the page.
- **Internationalization:** pre-render `/en/` and `/es/`; date/time already normalized to Europe/Madrid in your generator.
- **No external calls:** no fonts, no map SDKs, no analytics; maximizes longevity and CSP strength.
